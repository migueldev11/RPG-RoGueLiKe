<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Roguelike ASCII com Vários Inimigos</title>
<style>
  body {
    font-family: monospace;
    background: #111;
    color: #eee;
    margin: 0; padding: 10px;
    user-select: none;
    -webkit-user-select: none;
  }
  #game {
    background: #222;
    line-height: 1.1;
    letter-spacing: 0.15em;
    font-size: 16px;
    white-space: pre;
    width: max-content;
    padding: 10px;
    border: 2px solid #555;
  }
  #status {
    margin-top: 10px;
    background: #333;
    padding: 6px;
    border: 1px solid #555;
  }
  #messages {
    margin-top: 8px;
    height: 80px;
    overflow-y: auto;
    background: #222;
    border: 1px solid #555;
    padding: 6px;
    font-size: 14px;
  }
</style>
</head>
<body>

<h2>Roguelike ASCII com Vários Inimigos</h2>
<pre id="game"></pre>

<div id="status">
  Vida: <span id="hp">30</span> |
  Level: <span id="level">1</span> |
  EXP: <span id="exp">0</span>
</div>

<div id="messages"></div>

<script>
(() => {
  const MAP_W = 40;
  const MAP_H = 20;

  let map = [];
  let player = {x: 1, y: 1, hp: 30, maxHp: 30, level: 1, exp: 0};
  let enemies = [];

  const enemyTypes = [
    {name: 'Zumbi', char: 'Z', hp: 12, attack: 4},
    {name: 'Goblin', char: 'g', hp: 10, attack: 5},
    {name: 'Esqueleto', char: 'S', hp: 15, attack: 6},
    {name: 'Aranha', char: 'A', hp: 8, attack: 3},
    {name: 'Mago Sombrio', char: 'M', hp: 10, attack: 7},
    {name: 'Lobo', char: 'L', hp: 14, attack: 6},
    {name: 'Troll', char: 'T', hp: 20, attack: 8},
    {name: 'Slime', char: 's', hp: 6, attack: 2},
    {name: 'Orc', char: 'O', hp: 18, attack: 7},
    {name: 'Vampiro', char: 'V', hp: 16, attack: 7}
  ];

  const gameElem = document.getElementById('game');
  const hpElem = document.getElementById('hp');
  const levelElem = document.getElementById('level');
  const expElem = document.getElementById('exp');
  const messagesElem = document.getElementById('messages');

  function addMessage(text) {
    messagesElem.textContent += text + '\n';
    messagesElem.scrollTop = messagesElem.scrollHeight;
  }

  function generateMap() {
    map = [];
    for (let y = 0; y < MAP_H; y++) {
      let row = '';
      for (let x = 0; x < MAP_W; x++) {
        if (y === 0 || y === MAP_H-1 || x === 0 || x === MAP_W-1) {
          row += '#';
        } else {
          row += (Math.random() < 0.2) ? '#' : '.';
        }
      }
      map.push(row);
    }
    map[1] = '.' + map[1].slice(1, MAP_W - 1) + '.';
  }

  function placeEnemies(count) {
    enemies = [];
    let placed = 0;
    while(placed < count) {
      let x = 1 + Math.floor(Math.random() * (MAP_W - 2));
      let y = 1 + Math.floor(Math.random() * (MAP_H - 2));
      if (map[y][x] === '.' && !(x === player.x && y === player.y) && !enemies.some(e => e.x === x && e.y === y)) {
        const type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
        enemies.push({x, y, hp: type.hp, maxHp: type.hp, attack: type.attack, char: type.char, name: type.name});
        placed++;
      }
    }
  }

  function draw() {
    let output = '';
    for (let y = 0; y < MAP_H; y++) {
      for (let x = 0; x < MAP_W; x++) {
        if (player.x === x && player.y === y) {
          output += '@';
        } else {
          let enemy = enemies.find(e => e.x === x && e.y === y && e.hp > 0);
          if (enemy) output += enemy.char;
          else output += map[y][x];
        }
      }
      output += '\n';
    }
    gameElem.textContent = output;
    hpElem.textContent = player.hp;
    levelElem.textContent = player.level;
    expElem.textContent = player.exp;
  }

  function isWalkable(x,y) {
    if (x < 0 || x >= MAP_W || y < 0 || y >= MAP_H) return false;
    if (map[y][x] === '#') return false;
    if (enemies.some(e => e.x === x && e.y === y && e.hp > 0)) return false;
    return true;
  }

  function attack(attacker, defender) {
    let damage = attacker.attack;
    defender.hp -= damage;
    addMessage(`${attacker === player ? 'Você' : defender === player ? attacker.name : 'Inimigo'} causou ${damage} de dano!`);
    if (defender.hp <= 0) {
      addMessage(defender === player ? 'Você morreu! Fim de jogo.' : `${defender.name} morto!`);
      if (defender !== player) {
        player.exp += 10;
        if (player.exp >= player.level * 20) {
          player.level++;
          player.maxHp += 10;
          player.hp = player.maxHp;
          addMessage(`Você subiu para o nível ${player.level}!`);
        }
      }
    }
  }

  function enemyTurn() {
    for (const e of enemies) {
      if (e.hp <= 0) continue;
      const dx = player.x - e.x;
      const dy = player.y - e.y;
      const dist = Math.abs(dx) + Math.abs(dy);

      if (dist === 1) {
        attack(e, player);
        if (player.hp <= 0) break;
      } else {
        let stepX = dx !== 0 ? dx / Math.abs(dx) : 0;
        let stepY = dy !== 0 ? dy / Math.abs(dy) : 0;
        let nx = e.x + stepX;
        let ny = e.y + stepY;
        if (isWalkable(nx, ny)) {
          e.x = nx;
          e.y = ny;
        }
      }
    }
    draw();
  }

  function movePlayer(dx, dy) {
    if (player.hp <= 0) return;
    const nx = player.x + dx;
    const ny = player.y + dy;
    if (map[ny][nx] === '#') {
      addMessage('Você bateu em uma parede!');
      return;
    }
    const enemy = enemies.find(e => e.x === nx && e.y === ny && e.hp > 0);
    if (enemy) {
      attack(player, enemy);
      if (enemy.hp <= 0) enemies = enemies.filter(en => en.hp > 0);
    } else if (isWalkable(nx, ny)) {
      player.x = nx;
      player.y = ny;
      addMessage(`Você andou para (${nx},${ny})`);
    }
    draw();
    enemyTurn();
  }

  window.addEventListener('keydown', e => {
    switch(e.key) {
      case 'ArrowUp': movePlayer(0, -1); break;
      case 'ArrowDown': movePlayer(0, 1); break;
      case 'ArrowLeft': movePlayer(-1, 0); break;
      case 'ArrowRight': movePlayer(1, 0); break;
    }
  });

  generateMap();
  placeEnemies(10);
  draw();
  addMessage('Use as setas para mover. Ataque inimigos andando sobre eles.');
})();
</script>

</body>
</html>